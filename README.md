# @enterprise-cmcs/serverless-waf-plugin

## This is a serverless plugin which has an intelligent set of rules for a waf.

### Getting Started

To install the required plugins run the following commands:

```
npm i -D @enterprise-cmcs/serverless-waf-plugin
npm i -D serverless-associate-waf
```

### Notes

This plugin is meant to be used in conjunction with another plugin called [serverless-associate-waf](https://github.com/mikesouza/serverless-associate-waf)

This plugin simply creates the waf and the above plugin will associate the waf with the desired resource.

### Example usage

There are a few configuration options that can be set in the serverless.yml but if you do not need to customize the waf rules at all then simply including the plugin will suffice. The naming convention used for the waf that this plugin generates is the following.

```
[stage-name]-[service-name]-webacl
```

This is important to note as you will be using this name in the associate waf plugin to associate the resource. Below is an example of what a serverless.yml file will look like (the peices that need configured).

```
plugins:
  - "@enterprise-cmcs/serverless-waf-plugin"
  - serverless-associate-waf

custom:
  stage: ${opt:stage, self:provider.stage}
  webAclName: ${self:custom.stage}-${self:service}--webacl
  associateWaf:
    name: ${self:custom.webAclName}
    version: V2

```

There are also currently three customizable rules that can be used by the waf plugin. They are the following:

- awsCommon
- awsIpReputation
- awsBadInputs

Below is an example of how you would set an exclude rule in the serverless.yml file:

```
custom:
    wafExcludeRules:
        awsCommon:
            - "SizeRestrictions_BODY"
```

Below is an example of how you would set a custom rate-limit (to protect against ddos attacks) in the serverless.yml file:

(Note: if no value is set for the rate limit the default is 5000)

```
custom:
    wafExcludeRules:
        awsRateLimit: 200
```

Below is an example of how to enable logging to cloudwatch from within the serverless.yml file. The cloudwatch log group will be called `aws-waf-logs-[stage-name]-[service-name]-webacl`:

(Note: The default value for logging is set to false meaning ther will be no logs)

```
custom:
    wafExcludeRules:
        enableLogging: true
```

Here is an example of how to set the scope of the web acl. This is important if you need to have a web acl for a cloudfront distribution. The default is REGIONAL and there are two options (REGIONAL & CLOUDFRONT)

```
custom:
    wafExcludeRules:
        wafScope: CLOUDFRONT
```

The resource name of the web acl that is generated by this plugin is **WafPluginAcl**. This resource name will be important if you need to access the resource from within your serverless.yml. An example of when this would be necessary is for associating the web acl with a cloudfront distribution.
